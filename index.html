<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/posterlayout.css"> 
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        
        <title></title>
    </head>
    <body>

    <div class="page-title">
    Exploring Climate Adaptation Measures in Saint Michel, Montréal, QC    </div>

 <div class="layout-container">

    <div class="left-column">
        <div class="map-box">
            <div id="map"></div>
        </div>

        <div id="legend-panel">

    <div id="layerToggle">
        <h3>Layers (click the layer you would like to consult)</h3>
        <label><input type="checkbox" data-layer="layer_VCC_clipped_rains_1"> Vulnerability to Heavy Rains</label><br>
        <label><input type="checkbox" data-layer="layer_cuvettes"> Hydrological Surface Depressions</label><br>
        <label><input type="checkbox" data-layer="layer_VCC_clipped_drought_2"> Vulnerability to Drought</label><br>
        <label><input type="checkbox" data-layer="layer_VCC_clipped_storms_3"> Vulnerability to Destructive Storms</label><br>
        <label><input type="checkbox" data-layer="layer_VCC_clipped_heat_6"> Vulnerability to Heat Waves</label><br>
        <label><input type="checkbox" data-layer="layer_UHI_SM_5"> Urban Heat Island Effect</label><br>
        <label><input type="checkbox" data-layer="layer_LanduseSM_7"> Land Use in the Neighbourhood</label><br>
        <label><input type="checkbox" data-layer="layer_greenspaces_SM_8"> Green Spaces</label><br>
        <label><input type="checkbox" data-layer="layer_publicfacilities"> Public Facilities</label><br>
        <label><input type="checkbox" data-layer="layer_CISR">Canadian Index of Social Resilience 2021</label><br>
        <label><input type="checkbox" data-layer="layer_CISV">Canadian Index of Social Vulnerability 2021</label><br>

    </div>

    <div id="legend-container"></div>

</div>
    </div>

        <!-- RIGHT COLUMN (text boxes) -->
        <div class="right-column">
            <div class="text-box">Introduction and Neighbourhood Overview<br>
                <p>The Saint-Michel neighborhood is in the easternmost section of the Villeray-Parc-Extension-St-Michel borough of Montreal. It started as a farming community at the northern edge of the city, flanked on both sides by major quarries (carrieres Miron and Francon) which still dominate the neighburhood's nothern section. Rapid urbanization and population growth arrived in the mid-20th century,  and the construction of the Autoroute 40 bisecting the neighborhood led to industry moving in. The western quarry was turned into a major landfill in 1968 and the eastern quarry became a snow dumping site for 40% of the island.<br><br>
Saint-Michel boulevard runs through the neihgbourhood center, flanked by businesses and multiple schools. The southern section (Francois Perrault) is less isolated, having access to the metro, and is also host to many municipal buildings. 
The conversion of the former Miron quarry into Frederic-Back Park, the presence of the second quarry, and the level of paved surface in this area makes Saint-Michel an interesting zone for our assessment.<br></p>
</div>
            <div class="text-box">Hazard Identification
                 <br> <p>
Various climate hazards face the neighbourhood of Saint-Michel. While elevation and distance from the rivers’ edge may reduce the risk of river flood events, the neighbourhood's geography and urban form still expose certain areas of the neighbourhood to elevated vulnerability to risk like heat waves, drought, and heavy rains. Factors like the urban heat island effect and local depressions can make this even worse for residents. 
<br><br>
Click on the various layer toggles in the legend at the bottom left to explore vulnerability to climate-related hazards. 
</p>
            </div>
            <div class="text-box">Current Adaptation Measures <br>
                <p>The current adaptation measures implemented by the borough tend to be more general. Climate Change Adaptation Plan for the Montréal Urban Agglomeration 2015-2020 mainly lists initiatives related to urban greening and water management, and many reported infrastructure measures refer only to improving its resilience without specific examples. However, various bylaws have been adopted on water conservation, tree planting standards, and roof renovation (white and green roofs). Site-specific adaptation measures include the use of rainwater harvesting and retention at the Arena de Saint Michel, or the construction of a large lake as part of the design of Parc Frédérique Back meant to capture surface runoff from heavy rains and slow their entrance into the wastewater under-capacity wastewater systems. </p>

            </div>




            <div class="text-box">Proposed Adaptation Measures <br><p>

Our proposed measures are a mixture of new proposed ideas and improvements / enhancements of existing projects that ought to go further to better address the borough’s needs and its potential, notably as concerns precipitation management and reducing its severe urban heat island effect. The largest areas for potential impact are the highly-artificialized Blvd. Saint Michel corridor with the numerous public facilities that the City could leverage control over to implement better greening projects, more extensive sponge parks, or using them as cooling or heating centers during extreme weather events. We also suggest continuing with the rehabilitation of the quarry spaces as, properly designed, these could serve as climate adaptation poles for the neighbourhood and surrounding areas, notably helping to mitigate pluvial flooding or providing a break from UHI. 
<br> It should be noted that many of these measures would be implemented borough-wide; for the purposes of this exercise, they have been mapped to specific suggestive locations for illustrative purposes only.  
<br>Hover over a point to display its name, and click for a longer description. </p>
</div>
        </div>

        


    </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/multi-style-layer.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="data/VCC_clipped_rains_1.js"></script>
        <script src="data/VCC_clipped_drought_2.js"></script>
        <script src="data/VCC_clipped_storms_3.js"></script>
        <script src="data/UHI_SM_5.js"></script>
        <script src="data/VCC_clipped_heat_6.js"></script>
        <script src="data/LanduseSM_7.js"></script>
        <script src="data/greenspaces_SM_8.js"></script>
        <script src="data/publicfacilities.js"></script>
        <script src="data/cuvettes.js"></script>
        <script src="data/CISV.js"></script>
        <script src="data/CISR.js"></script>
        <script src="data/adaptationmeasures.js"></script>
        <script>
        var map = L.map('map', {
                zoomControl: false,
                maxZoom: 28,
                minZoom: 1
                }).setView([45.566165, -73.614744], 13.5);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OpenStreetMap_0;
        map.addLayer(layer_OpenStreetMap_0);
        

        function style_VCC_clipped_rains_1_0(feature) {
            if (feature.properties['PluiesCl'] >= 0.500000 && feature.properties['PluiesCl'] <= 1.500000 ) {
                return {
                pane: 'pane_VCC_clipped_rains_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(247,251,255,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['PluiesCl'] >= 1.500000 && feature.properties['PluiesCl'] <= 2.500000 ) {
                return {
                pane: 'pane_VCC_clipped_rains_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(200,220,240,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['PluiesCl'] >= 2.500000 && feature.properties['PluiesCl'] <= 3.500000 ) {
                return {
                pane: 'pane_VCC_clipped_rains_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(115,178,216,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['PluiesCl'] >= 3.500000 && feature.properties['PluiesCl'] <= 4.500000 ) {
                return {
                pane: 'pane_VCC_clipped_rains_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(41,121,185,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['PluiesCl'] >= 4.500000 && feature.properties['PluiesCl'] <= 5.500000 ) {
                return {
                pane: 'pane_VCC_clipped_rains_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(8,48,107,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_VCC_clipped_rains_1');
        map.getPane('pane_VCC_clipped_rains_1').style.zIndex = 401;
        map.getPane('pane_VCC_clipped_rains_1').style['mix-blend-mode'] = 'normal';
        var layer_VCC_clipped_rains_1 = new L.geoJson(json_VCC_clipped_rains_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_VCC_clipped_rains_1',
            layerName: 'layer_VCC_clipped_rains_1',
            pane: 'pane_VCC_clipped_rains_1',
            onEachFeature: function () {},
            style: style_VCC_clipped_rains_1_0,
        });
        bounds_group.addLayer(layer_VCC_clipped_rains_1);
       
        function style_cuvettes_0() {
    return {
        pane: 'pane_cuvettes',
        color: '#A6CEE3',
        weight: 2,
        fillOpacity: 0.9,
        fillColor: '#A6CEE3',
        interactive: true
    };
}
        map.createPane('pane_cuvettes');
        map.getPane('pane_cuvettes').style.zIndex = 409;
        map.getPane('pane_cuvettes').style['mix-blend-mode'] = 'normal';
        var layer_cuvettes = new L.geoJson(json_cuvettes, {
            attribution: '',
            interactive: true,
            dataVar: 'json_cuvettes',
            layerName: 'layer_cuvettes',
            pane: 'pane_cuvettes',
            onEachFeature: function () {},
            style: style_cuvettes_0,
        });
        bounds_group.addLayer(layer_cuvettes);
        

        function style_VCC_clipped_drought_2_0(feature) {
            if (feature.properties['SecheresCl'] >= 0.500000 && feature.properties['SecheresCl'] <= 1.500000 ) {
                return {
                pane: 'pane_VCC_clipped_drought_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,32,77,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['SecheresCl'] >= 1.500000 && feature.properties['SecheresCl'] <= 2.500000 ) {
                return {
                pane: 'pane_VCC_clipped_drought_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(65,77,107,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['SecheresCl'] >= 2.500000 && feature.properties['SecheresCl'] <= 3.500000 ) {
                return {
                pane: 'pane_VCC_clipped_drought_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(125,124,120,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['SecheresCl'] >= 3.500000 && feature.properties['SecheresCl'] <= 4.500000 ) {
                return {
                pane: 'pane_VCC_clipped_drought_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(190,175,111,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['SecheresCl'] >= 4.500000 && feature.properties['SecheresCl'] <= 5.000000 ) {
                return {
                pane: 'pane_VCC_clipped_drought_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,234,70,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_VCC_clipped_drought_2');
        map.getPane('pane_VCC_clipped_drought_2').style.zIndex = 402;
        map.getPane('pane_VCC_clipped_drought_2').style['mix-blend-mode'] = 'normal';
        var layer_VCC_clipped_drought_2 = new L.geoJson(json_VCC_clipped_drought_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_VCC_clipped_drought_2',
            layerName: 'layer_VCC_clipped_drought_2',
            pane: 'pane_VCC_clipped_drought_2',
            onEachFeature: function () {},
            style: style_VCC_clipped_drought_2_0,
        });
        bounds_group.addLayer(layer_VCC_clipped_drought_2);
        
        

        function style_VCC_clipped_storms_3_0(feature) {
            if (feature.properties['TempeteCl'] >= 0.500000 && feature.properties['TempeteCl'] <= 1.500000 ) {
                return {
                pane: 'pane_VCC_clipped_storms_3',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(247,252,245,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['TempeteCl'] >= 1.500000 && feature.properties['TempeteCl'] <= 2.500000 ) {
                return {
                pane: 'pane_VCC_clipped_storms_3',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(201,234,194,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['TempeteCl'] >= 2.500000 && feature.properties['TempeteCl'] <= 3.500000 ) {
                return {
                pane: 'pane_VCC_clipped_storms_3',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(123,199,124,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['TempeteCl'] >= 3.500000 && feature.properties['TempeteCl'] <= 4.500000 ) {
                return {
                pane: 'pane_VCC_clipped_storms_3',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(42,146,75,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['TempeteCl'] >= 4.500000 && feature.properties['TempeteCl'] <= 5.500000 ) {
                return {
                pane: 'pane_VCC_clipped_storms_3',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,68,27,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_VCC_clipped_storms_3');
        map.getPane('pane_VCC_clipped_storms_3').style.zIndex = 403;
        map.getPane('pane_VCC_clipped_storms_3').style['mix-blend-mode'] = 'normal';
        var layer_VCC_clipped_storms_3 = new L.geoJson(json_VCC_clipped_storms_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_VCC_clipped_storms_3',
            layerName: 'layer_VCC_clipped_storms_3',
            pane: 'pane_VCC_clipped_storms_3',
            onEachFeature: function () {},
            style: style_VCC_clipped_storms_3_0,
        });
        bounds_group.addLayer(layer_VCC_clipped_storms_3);
        
        
    

        function style_UHI_SM_5_0(feature) {
            switch(String(feature.properties['Legende'])) {
                case 'Îlot de chaleur':
                    return {
                pane: 'pane_UHI_SM_5',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(202,0,32,1.0)',
                interactive: true,
            }
                    break;
                case 'Température plus chaude que la moyenne (à risque)':
                    return {
                pane: 'pane_UHI_SM_5',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(244,165,130,1.0)',
                interactive: true,
            }
                    break;
                case 'Température plus proche de la moyenne':
                    return {
                pane: 'pane_UHI_SM_5',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(247,247,247,1.0)',
                interactive: true,
            }
                    break;
                case 'Température plus froide que la moyenne':
                    return {
                pane: 'pane_UHI_SM_5',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(146,197,222,1.0)',
                interactive: true,
            }
                    break;
                case 'Îlot de fraîcheur':
                    return {
                pane: 'pane_UHI_SM_5',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(5,113,176,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_UHI_SM_5');
        map.getPane('pane_UHI_SM_5').style.zIndex = 405;
        map.getPane('pane_UHI_SM_5').style['mix-blend-mode'] = 'normal';
        var layer_UHI_SM_5 = new L.geoJson(json_UHI_SM_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_UHI_SM_5',
            layerName: 'layer_UHI_SM_5',
            pane: 'pane_UHI_SM_5',
            onEachFeature: function () {},
            style: style_UHI_SM_5_0,
        });
        bounds_group.addLayer(layer_UHI_SM_5);
        
        

        function style_VCC_clipped_heat_6_0(feature) {
            if (feature.properties['ChaleurCl'] >= 0.500000 && feature.properties['ChaleurCl'] <= 1.500000 ) {
                return {
                pane: 'pane_VCC_clipped_heat_6',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,245,240,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['ChaleurCl'] >= 1.500000 && feature.properties['ChaleurCl'] <= 2.500000 ) {
                return {
                pane: 'pane_VCC_clipped_heat_6',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(252,190,165,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['ChaleurCl'] >= 2.500000 && feature.properties['ChaleurCl'] <= 3.500000 ) {
                return {
                pane: 'pane_VCC_clipped_heat_6',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(251,112,80,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['ChaleurCl'] >= 3.500000 && feature.properties['ChaleurCl'] <= 4.500000 ) {
                return {
                pane: 'pane_VCC_clipped_heat_6',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(211,32,32,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['ChaleurCl'] >= 4.500000 && feature.properties['ChaleurCl'] <= 5.500000 ) {
                return {
                pane: 'pane_VCC_clipped_heat_6',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(103,0,13,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_VCC_clipped_heat_6');
        map.getPane('pane_VCC_clipped_heat_6').style.zIndex = 406;
        map.getPane('pane_VCC_clipped_heat_6').style['mix-blend-mode'] = 'normal';
        var layer_VCC_clipped_heat_6 = new L.geoJson(json_VCC_clipped_heat_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_VCC_clipped_heat_6',
            layerName: 'layer_VCC_clipped_heat_6',
            pane: 'pane_VCC_clipped_heat_6',
            onEachFeature: function () {},
            style: style_VCC_clipped_heat_6_0,
        });
        bounds_group.addLayer(layer_VCC_clipped_heat_6);
        
        function pop_LanduseSM_7(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['categorie'] !== null ? autolinker.link(String(feature.properties['categorie']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_LanduseSM_7_0(feature) {
            switch(String(feature.properties['categorie'])) {
                case 'residentiel':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(250,243,202,1.0)',
                interactive: true,
            }
                    break;
                case 'parc':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(82,153,120,1.0)',
                interactive: true,
            }
                    break;
                case 'mixte':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(222,80,42,1.0)',
                interactive: true,
            }
                    break;
                case 'institution':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(154,150,80,1.0)',
                interactive: true,
            }
                    break;
                case 'emplois':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(207,202,217,1.0)',
                interactive: true,
            }
                    break;
                case 'infrastructure':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(228,222,220,1.0)',
                interactive: true,
            }
                    break;
                case 'activites diversifies':
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(242,158,126,1.0)',
                interactive: true,
            }
                    break;
                default:
                    return {
                pane: 'pane_LanduseSM_7',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(89,229,159,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_LanduseSM_7');
        map.getPane('pane_LanduseSM_7').style.zIndex = 407;
        map.getPane('pane_LanduseSM_7').style['mix-blend-mode'] = 'normal';
        var layer_LanduseSM_7 = new L.geoJson(json_LanduseSM_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_LanduseSM_7',
            layerName: 'layer_LanduseSM_7',
            pane: 'pane_LanduseSM_7',
            onEachFeature: function () {},
            style: style_LanduseSM_7_0,
        });
        bounds_group.addLayer(layer_LanduseSM_7);
        
        // --- HOVER LABEL FUNCTION (replaces popup function) ---
function pop_greenspaces_SM_8(feature, layer) {

    // Get name field for tooltip
    const name = feature.properties['Nom'] || "";

    // Hover tooltip
    layer.bindTooltip(name, {
        sticky: true,
        direction: "auto",
        opacity: 0.9,
        className: "greenspace-tooltip"
    });

    // Optional hover highlight
    layer.on('mouseover', function () {
        layer.setStyle({ weight: 2.0, color: "#555" });
    });

    layer.on('mouseout', function () {
        // Reset only the outline style; multiStyle handles the other fills
        layer.setStyle({
            color: 'rgba(119,119,119,1.0)',
            weight: 1.2
        });
    });
}






// --- STYLE 2: Solid fill + grey outline ---
function style_greenspaces_SM_8_2() {
    return {
        pane: 'pane_greenspaces_SM_8',
        color: 'rgba(119,119,119,1.0)',       // mid-grey outline
        weight: 1.2,
        fill: true,
        fillColor: 'rgba(178,223,149,1.0)',   // solid fill colour
        fillOpacity: 1,
        interactive: true
    }
}

// --- MULTISTYLE LAYER ---
map.createPane('pane_greenspaces_SM_8');
map.getPane('pane_greenspaces_SM_8').style.zIndex = 408;
map.getPane('pane_greenspaces_SM_8').style['mix-blend-mode'] = 'normal';

var layer_greenspaces_SM_8 = L.geoJSON(json_greenspaces_SM_8, {
    attribution: '',
    interactive: true,
    dataVar: 'json_greenspaces_SM_8',
    layerName: 'layer_greenspaces_SM_8',
    pane: 'pane_greenspaces_SM_8',
    onEachFeature: pop_greenspaces_SM_8,
    style: style_greenspaces_SM_8_2   // only one style now
});


bounds_group.addLayer(layer_greenspaces_SM_8);




///Adaptationmeasures 

function style_adaptationmeasures_0(feature) {
    const status = feature.properties.implementation;

    if (status === "Proposed") {
        return {
            pane: 'pane_adaptationmeasures',
            radius: 6,
            color: '#1f78b4',
            weight: 1,
            fillColor: '#a6cee3',
            fillOpacity: 1,
            interactive: true
        };
    }
    if (status === "Improved") {
        return {
            pane: 'pane_adaptationmeasures',
            radius: 6,
            color: '#0b4d7a',
            weight: 1,
            fillColor: '#1f78b4',
            fillOpacity: 1,
            interactive: true
        };
    }
    return {   // Implemented
        pane: 'pane_adaptationmeasures',
        radius: 6,
        color: '#042b63',
        weight: 1,
        fillColor: '#084594',
        fillOpacity: 1,
        interactive: true
    };
}

function pop_adaptationmeasures(feature, layer) {

    // Hover → show only the NAME
    const name = feature.properties.name || "";
    layer.bindTooltip(name, {
        sticky: true,
        direction: "top",
        opacity: 0.9,
        className: "adaptation-hover-label"
    });

    // Click → show popup with description
    const description = feature.properties.description || "No description provided.";
    const popupContent = `
        <b>${name}</b><br><br>
        ${description}
    `;

    layer.bindPopup(popupContent, {maxHeight: 300});
}

map.createPane('pane_adaptationmeasures');
map.getPane('pane_adaptationmeasures').style.zIndex = 499;
map.getPane('pane_adaptationmeasures').style['mix-blend-mode'] = 'normal';

var layer_adaptationmeasures = new L.geoJson(json_adaptationmeasures, {
    attribution: '',
    interactive: true,
    dataVar: 'json_adaptationmeasures',
    layerName: 'layer_adaptationmeasures',
    pane: 'pane_adaptationmeasures',
    onEachFeature: pop_adaptationmeasures,
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, style_adaptationmeasures_0(feature));
    }
});

bounds_group.addLayer(layer_adaptationmeasures);
window.layer_adaptationmeasures = layer_adaptationmeasures;
map.addLayer(layer_adaptationmeasures);







// --- Public Facilities Layer ---  

// Hover label styling
const facilityHoverLabel = L.tooltip({
    permanent: false,
    direction: "top",
    offset: [0, -10],
    opacity: 0.9,
    className: "facility-hover-label"
});

function iconForFacility(feature) {
    const type = feature.properties.facilitytype || "default";

    return L.divIcon({
        className: "facility-icon",
        html: `
            <div class="facility-wrapper">
                <img src="images/${type}.svg" class="facility-img"/>
            </div>
        `,
        iconSize: [32, 32],   // overall clickable size
        iconAnchor: [16, 16]  // centers the icon
    });
}

function onEachPublicFacility(feature, layer) {

    // --- Hover ON ---
    layer.on("mouseover", function (e) {
        const name = feature.properties.name || "(no name)";
        facilityHoverLabel
            .setLatLng(e.latlng)
            .setContent(`<b>${name}</b>`);
        map.openTooltip(facilityHoverLabel);
    });

    // --- Hover OFF ---
    layer.on("mouseout", function () {
        map.closeTooltip(facilityHoverLabel);
    });
}

map.createPane('pane_publicfacilities');
map.getPane('pane_publicfacilities').style.zIndex = 410;

var layer_publicfacilities = L.geoJson(json_publicfacilities, {
    pane: 'pane_publicfacilities',
    onEachFeature: onEachPublicFacility,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, {
            icon: iconForFacility(feature),
            pane: 'pane_publicfacilities'

        });
    }
});
//CISV 
function style_CISV(feature) {
    const v = Number(feature.properties["cisv_scores_quintiles-eng_CISV Quintiles"]);

    if (v === 1) return { pane: 'pane_CISV', color: '#444', weight: 1, fillColor: '#fff5eb', fillOpacity: 1 };
    if (v === 2) return { pane: 'pane_CISV', color: '#444', weight: 1, fillColor: '#fdcc8a', fillOpacity: 1 };
    if (v === 3) return { pane: 'pane_CISV', color: '#444', weight: 1, fillColor: '#fc8d59', fillOpacity: 1 };
    if (v === 4) return { pane: 'pane_CISV', color: '#444', weight: 1, fillColor: '#d7301f', fillOpacity: 1 };
    return            { pane: 'pane_CISV', color: '#444', weight: 1, fillColor: '#7f0000', fillOpacity: 1 };
}


map.createPane("pane_CISV");
map.getPane("pane_CISV").style.zIndex = 451;

var layer_CISV = L.geoJson(json_CISV, {
    attribution: "",
    interactive: true,
    dataVar: "json_CISV",
    layerName: "layer_CISV",
    pane: "pane_CISV",
    onEachFeature: function(){},
    style: style_CISV
});

window.layer_CISV = layer_CISV;
bounds_group.addLayer(layer_CISV);


//CISR
function style_CISR(feature) {
    const v = Number(feature.properties["cisr_scores_quintiles-eng_CISR Quintiles"]);

    if (v === 1) return { pane: 'pane_CISR', color: '#444', weight: 1, fillColor: '#f7fbff', fillOpacity: 1 };
    if (v === 2) return { pane: 'pane_CISR', color: '#444', weight: 1, fillColor: '#c8dcf0', fillOpacity: 1 };
    if (v === 3) return { pane: 'pane_CISR', color: '#444', weight: 1, fillColor: '#73b2d8', fillOpacity: 1 };
    if (v === 4) return { pane: 'pane_CISR', color: '#444', weight: 1, fillColor: '#2979b9', fillOpacity: 1 };
    return            { pane: 'pane_CISR', color: '#444', weight: 1, fillColor: '#08306b', fillOpacity: 1 };
}

map.createPane("pane_CISR");
map.getPane("pane_CISR").style.zIndex = 450;

var layer_CISR = L.geoJson(json_CISR, {
    attribution: "",
    interactive: true,
    dataVar: "json_CISR",
    layerName: "layer_CISR",
    pane: "pane_CISR",
    onEachFeature: function(){},
    style: style_CISR
});

window.layer_CISR = layer_CISR;
bounds_group.addLayer(layer_CISR);




        

// --------------------
// 1. Legend definitions
// --------------------
const legends = {
    "layer_VCC_clipped_rains_1": `
        <h3> Vunerability to Heavy Rains</h3>
        <div><span style="background:#f7fbff"></span> Insignificant</div>
        <div><span style="background:#c8dcf0"></span> Minor</div>
        <div><span style="background:#73b2d8"></span> Moderate </div>
        <div><span style="background:#2979b9"></span> High</div>
        <div><span style="background:#08306b"></span> Major</div>
    `,
    "layer_cuvettes": `
        <h3> Surface Hydrological Depressions (dips in surface wherein rain can accumulate)</h3>
        <div><span style="background:#A6CEE3"></span> Depression</div>
       
    `,

    "layer_VCC_clipped_drought_2": `
        <h3>Vulnerability to Drought</h3>
        <div><span style="background:#00204d"></span> Insignificant</div>
        <div><span style="background:#414d6b"></span> Minor</div>
        <div><span style="background:#7d7c78"></span> Moderate </div>
        <div><span style="background:#beaf6f"></span> High</div>
        <div><span style="background:#ffea46"></span> Major </div>
    `,

    "layer_VCC_clipped_storms_3": `
        <h3>Vulnerability to Destructive Storms</h3>
        <div><span style="background:#f7fcf5"></span> Insignificant</div>
        <div><span style="background:#c9eac2"></span> Minor</div>
        <div><span style="background:#7bc77c"></span> Moderate</div>
        <div><span style="background:#2a924b"></span> High</div>
        <div><span style="background:#00441b"></span> Major</div>
    `,

    "layer_VCC_clipped_heat_6": `
        <h3>Vulnerability to Heat Waves</h3>
        <div><span style="background:#fff5f0"></span> Insignificant</div>
        <div><span style="background:#fcbfa5"></span> Minor</div>
        <div><span style="background:#fb7050"></span> Moderate</div>
        <div><span style="background:#d32020"></span> High</div>
        <div><span style="background:#67000d"></span> Major</div>
    `,

    "layer_UHI_SM_5": `
        <h3>Exposure to Urban Heat Island Effect</h3>
        <div><span style="background:#ca0020"></span> Hotspot</div>
        <div><span style="background:#f4a582"></span> Above average temperature</div>
        <div><span style="background:#f7f7f7"></span> Near average temperature</div>
        <div><span style="background:#92c5de"></span> Cooler temperature</div>
        <div><span style="background:#0571b0"></span> Cool island</div>
    `,

    "layer_LanduseSM_7": `
        <h3>Land Use types </h3>
        <div><span style="background:#faf3ca"></span> Residential</div>
        <div><span style="background:#529978"></span> Large Park</div>
        <div><span style="background:#de502a"></span> Mixed</div>
        <div><span style="background:#9a9650"></span> Institutional</div>
        <div><span style="background:#cfcad9"></span> Employment</div>
        <div><span style="background:#e4dcdc"></span> Infrastructure</div>
        <div><span style="background:#f29e7e"></span> Diverse activities</div>
    `,

    "layer_greenspaces_SM_8": `
        <h3>Green spaces (hover on map to see names)</h3>
        <div><span style="background:#b2df8a;border:1px solid #333"></span> Green Space</div>
    `,
    
    "layer_CISV": `
    <h3>Canadian Index of Social Vulnerability - Quintiles</h3>
    <p> Assesses the vulnerability of communities to natural hazards and disasters, and data is classified into national-level quintiles. </p>
    <div><span style="background:#fff5eb"></span> 1 - Least vulnerable</div>
    <div><span style="background:#fdcc8a"></span> 2 </div>
    <div><span style="background:#fc8d59"></span> 3 </div>
    <div><span style="background:#d7301f"></span> 4 </div>
    <div><span style="background:#7f0000"></span> 5 - Most vulnerable</div>
`,
"layer_CISR": `
    <h3>Canadian Index of Social Resilience - Quintiles</h3>
    <p> Assesses the resilience of communities to natural hazards and disasters, and data is classified into national-level quintiles. </p>
    <div><span style="background:#f7fbff"></span> 1 - Least resilient </div>
    <div><span style="background:#c8dcf0"></span> 2 </div>
    <div><span style="background:#73b2d8"></span> 3 </div>
    <div><span style="background:#2979b9"></span> 4 </div>
    <div><span style="background:#08306b"></span> 5 - Most resilient</div>
`,
"layer_adaptationmeasures": `
    <h3>Adaptation Measures</h3>
    <div><span style="background:#a6cee3"></span> Proposed</div>
    <div><span style="background:#1f78b4"></span> Improved</div>
    <div><span style="background:#084594"></span> Implemented</div>
`,

"layer_publicfacilities": `
    <h3>Public Facilities (hover over points for names)</h3>

    <div style="display:flex; align-items:center; margin-bottom:6px;">
        <img src="images/health.svg" style="width:20px; height:20px; margin-right:6px;">
        Health Facility
    </div>

    <div style="display:flex; align-items:center; margin-bottom:6px;">
        <img src="images/metro.svg" style="width:20px; height:20px; margin-right:6px;">
        Metro Station
    </div>

    <div style="display:flex; align-items:center; margin-bottom:6px;">
        <img src="images/recreation.svg" style="width:20px; height:20px; margin-right:6px;">
        Recreation Facility
    </div>

    <div style="display:flex; align-items:center; margin-bottom:6px;">
        <img src="images/school.svg" style="width:20px; height:20px; margin-right:6px;">
        School
    </div>
`,
};


// ------------------------------
// 2. Function to update legend
// ------------------------------
function updateLegend() {
    const legendDiv = document.getElementById("legend-container");
    legendDiv.innerHTML = "";  // Clear old legend

    // ----------------------------------------
    // 1. ALWAYS show adaptation measures legend
    // ----------------------------------------
    if (legends["layer_adaptationmeasures"]) {
        legendDiv.innerHTML += legends["layer_adaptationmeasures"];
    }

    // ------------------------------------------------
    // 2. THEN show the legend for the toggled-on layer
    // ------------------------------------------------
    document.querySelectorAll('#layerToggle input[type="checkbox"]').forEach(cb => {
        if (cb.checked) {
            const layerName = cb.dataset.layer;
            if (legends[layerName]) {
                legendDiv.innerHTML += legends[layerName];
            }
        }
    });
}


// Initial load:
updateLegend();


// -------------------------------------------------
// 3. Attach event listeners to layer toggle checkboxes
// -------------------------------------------------
document.querySelectorAll('#layerToggle input[type="checkbox"]').forEach(cb => {
    cb.addEventListener("change", function () {
    const selectedLayer = cb.dataset.layer;

    // 1. Turn OFF all other checkboxes + remove their layers
    document.querySelectorAll('#layerToggle input[type="checkbox"]').forEach(other => {
        if (other !== cb) {
            other.checked = false;
            const otherLayerName = other.dataset.layer;
            if (window[otherLayerName]) {
                map.removeLayer(window[otherLayerName]);
            }
        }
    });

    // 2. Turn ON the selected layer
    if (cb.checked) {
        map.addLayer(window[selectedLayer]);
    } else {
        map.removeLayer(window[selectedLayer]);
    }

    // 3. Update legend
    updateLegend();
});

});








        </script>
                
    </body>
</html>
